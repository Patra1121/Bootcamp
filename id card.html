<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF‑8" />
  <meta name="viewport" content="width=device-width,initial‑scale=1" />
  <title>ID Card </title>
  <!-- QRCode.js -->
  <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs/qrcode.min.js"></script>
  <!-- html2canvas -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    /* simple reset + form spacing */
    *{margin:0;padding:0;box‑sizing:border-box;font-family:Arial,sans-serif}
    body{background:#f2f7fa;padding:1rem;color:#333;display:flex;flex-direction:column;align-items:center;gap:1rem}
    h1{color:#145da0;margin-bottom:.5rem}
    form#user-form{display:grid;gap:0.75rem;width:100%;max-width:360px}
    label{display:flex;flex-direction:column;font-size:.9rem;color:#555}
    input, select, button{font-size:1rem;padding:.45rem;border:1px solid #ccc;border-radius:4px;width:100%}
    button{cursor:pointer;background:#197278;color:white;border:none}
    button:hover{background:#145da0}

    /* ID card styling */
    #id-card{width:350px;aspect-ratio:55/35;border:2px solid #197278;border-radius:8px;background:#fff;padding:1rem;display:flex;
      flex-direction:column;justify-content:space-between;box-shadow:0 0 8px rgba(0,0,0,0.1);position:relative}
    .top{display:flex;justify-content:space-between;align-items:center;gap:1rem}
    .logo-placeholder{width:60px;height:60px;border:1px dashed #aaa;display:flex;align-items:center;
      justify-content:center;font-size:.7rem;color:#aaa;overflow:hidden;border-radius:4px}
    .logo-placeholder img{width:100%;height:100%;object-fit:cover}
    .photo-placeholder{min-width:80px;height:100px;border:1px solid #999;background:#eee;
      border-radius:4px;overflow:hidden}
    .photo-placeholder img{width:100%;height:100%;object-fit:cover}

    .info{margin-top:.75rem;flex:1;display:grid;grid-template-columns:1fr auto;gap:0.5rem;font-size:.9rem}
    .info > div{margin-bottom:.5rem}
    .dates{font-size:.75rem;color:#666;margin-top:.5rem}

    .qr-year{margin:0 auto;width:80px;height:80px}
    #qrcode{transform:scale(0.8);transform-origin:center}
    #message{font-size:1rem;color:#145da0}

    /* download/print button */
    #download-btn{margin-top:1rem;font-size:1rem;padding:.75rem;background:#ffa62b;color:#333;border:none;
      border-radius:4px}
    #download-btn:hover{background:#e0890f}

    /* print styles to hide form and buttons */
    @media print {
      body>*:not(#id-card){display:none !important}
      #id-card{box-shadow:none;border-color:#000}
      #id-card,html{overflow:visible}
      #download-btn::after{content:" (printed)";display:block;font-size:.8rem;color:#666;margin-top:.25rem}
      @page{margin:0}
    }
  </style>
</head>
<body>
  <h1>ID Card</h1>

  <form id="user-form" aria-label="ID card details">
    <label>Full Name<input type="text" id="name" placeholder="Jane Doe" required /></label>
    <label>ID Number<input type="text" id="idnum" placeholder="123456" required /></label>
    <label>Position<input type="text" id="position" placeholder="Student / Employee" required /></label>
    <label>Organization<input type="text" id="org" placeholder="Company or School" required /></label>
    <label>Upload Photo<input type="file" id="photo" accept="image/*" /></label>
    <label>Upload Logo (optional)<input type="file" id="logo" accept="image/*" /></label>
    <button type="button" id="preview-btn">Refresh Preview</button>
  </form>

  <div id="message">Preview shows your ID card.</div>

  <div id="id-card" role="img" aria-label="Generated ID card">
    <div class="top">
      <div>
        <strong id="card-name">Jane Doe</strong><br/>
        <span id="card-id">ID: 123456</span>
      </div>
      <div class="logo-placeholder" title="Organization logo"><img id="card-logo" alt="" /></div>
    </div>
    <div class="top" style="margin-top:.5rem">
      <div>
        <div id="card-pos">Position</div>
        <div id="card-org">Organization</div>
        <div class="dates">
          <div>Issued: <span id="card-issued">2025‑08‑02</span></div>
          <div>Expires: <span id="card-expires">2026‑08‑01</span></div>
        </div>
      </div>
      <div class="photo-placeholder" title="Photo"><img id="card-photo" alt="portrait photo" /></div>
    </div>
    <div id="qrcode" class="qr‑year"></div>
    <div class="dates"><small>Generated by Web Tool</small></div>
  </div>

  <button id="download-btn">Download or Print</button>

<script>
// Utility: format YYYY‑MM‑DD
function toISO(d){let y=d.getFullYear(),m=d.getMonth()+1,p=d.getDate();return `${y}‑${m.toString().padStart(2,'0')}‑${p.toString().padStart(2,'0')}`;}

// Elements
const nameIn=document.getElementById('name'),idIn=document.getElementById('idnum'),
      posIn=document.getElementById('position'),orgIn=document.getElementById('org'),
      photoIn=document.getElementById('photo'),logoIn=document.getElementById('logo'),
      btnRefresh=document.getElementById('preview-btn'),
      cardName=document.getElementById('card-name'),cardId=document.getElementById('card-id'),
      cardPos=document.getElementById('card-pos'),cardOrg=document.getElementById('card-org'),
      cardPhoto=document.getElementById('card-photo'),cardLogo=document.getElementById('card-logo'),
      issued=document.getElementById('card-issued'),expires=document.getElementById('card-expires'),
      qrcodeEl=document.getElementById('qrcode'),downloadBtn=document.getElementById('download-btn'),
      msgEl=document.getElementById('message');

// initial dates
const today=new Date();issued.textContent=toISO(today);
const nextYear=new Date(today);nextYear.setFullYear(nextYear.getFullYear()+1);
expires.textContent=toISO(nextYear);

// Default placeholders
cardPhoto.src = '';
cardPhoto.alt = "User portrait (not provided)";
cardLogo.src = '';
cardLogo.alt = "";

// photo preview
photoIn.addEventListener('change', ()=>{
  const f=photoIn.files?.[0];
  if(!f) return cardPhoto.src='';
  cardPhoto.src = URL.createObjectURL(f);
});

// logo preview
logoIn.addEventListener('change', ()=>{
  const f=logoIn.files?.[0];
  if(!f) return cardLogo.src='';
  cardLogo.src = URL.createObjectURL(f);
});

// Refresh preview & regenerate QR
btnRefresh.addEventListener('click', makePreview);

function makePreview(){
  msgEl.textContent = "Updating preview\u2026";
  cardName.textContent = nameIn.value || "Jane Doe";
  cardId.textContent = "ID: " + (idIn.value || "123456");
  cardPos.textContent = posIn.value || "Student / Employee";
  cardOrg.textContent = orgIn.value || "Organization";

  // QR content
  const qrText = [
    `Name: ${cardName.textContent}`,
    `ID: ${idIn.value || "123456"}`,
    `Position: ${cardPos.textContent}`,
    `Org: ${cardOrg.textContent}`,
    `Issued: ${issued.textContent}`,
    `Expires: ${expires.textContent}`
  ].join("\n");

  qrcodeEl.innerHTML = "";
  new QRCode(qrcodeEl, {
    text: qrText,
    width: 100, height: 100,
    colorDark: "#000000", colorLight: "#ffffff",
    correctLevel: QRCode.CorrectLevel.H
  });
  msgEl.textContent = "Preview updated. Press download to save or print.";
}

// Trigger initial preview
makePreview();

// Download / print handling
downloadBtn.addEventListener('click', function(){
  msgEl.textContent = "Rendering image\u2026";
  html2canvas(document.getElementById('id-card'), {scale:2})
    .then(canvas => {
      canvas.toBlob(blob=>{
        const a=document.createElement('a');
        a.download = (nameIn.value||"ID_Card") + ".png";
        a.href = URL.createObjectURL(blob);
        document.body.append(a);
        a.click();
        a.remove();
        msgEl.textContent = "Download started (or open Print preview).";
      });
    })
    .catch(e => {
      console.error(e);
      msgEl.textContent = "Download failed: see console.";
    });
});

// Handle user pressing Ctrl+P — regenerate before print restart
window.addEventListener("beforeprint", makePreview);

</script>
</body>
</html>

